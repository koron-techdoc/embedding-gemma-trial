# 派生課題: 旧国名のクラスタリング

[城のクラスタリング](./report_castles.md)で学習により
旧国名の概念を獲得しているように見えた
ことから思いついた課題。

[Wikipedia: 旧国名](https://ja.wikipedia.org/wiki/%E6%97%A7%E5%9B%BD%E5%90%8D) にあるデータを加工し、
[旧国名から現在の都道府県名の 1:n のマップ](./japan_old_countries.tsv)を作製した。

## 結果

結果の列の意味

    名称    正解数/1    回答#1      回答#2      真実

<details>
<summary>学習前モデル: accuracy=0.035</summary>

```console
$ ./cluster_local_govs.py -l ./japan_old_countries.tsv -m google/embeddinggemma-300m
陸奥    0/1     埼玉県  北海道  青森県
陸中    0/2     埼玉県,東京都   北海道,岩手県   岩手県,秋田県
陸前    0/1     埼玉県  岩手県  宮城県
羽後    0/2     埼玉県,北海道   鳥取県,東京都   秋田県,山形県
羽前    0/1     埼玉県  北海道  山形県
岩代    0/1     岩手県  埼玉県  福島県
磐城    0/1     埼玉県  岩手県  福島県
常陸    0/1     埼玉県  東京都  茨城県
下総    0/2     埼玉県,東京都   北海道,沖縄県   茨城県,千葉県
下野    0/1     埼玉県  東京都  栃木県
上野    0/1     東京都  埼玉県  群馬県
武蔵    2/3     埼玉県,東京都,北海道    宮城県,広島県,山口県    埼玉県,東京都,神奈川県
上総    0/1     埼玉県  東京都  千葉県
安房    0/1     埼玉県  東京都  千葉県
相模    0/1     埼玉県  東京都  神奈川県
越後    0/1     埼玉県  北海道  新潟県
佐渡    0/1     佐賀県  埼玉県  新潟県
越中    0/1     埼玉県  北海道  富山県
能登    0/1     埼玉県  北海道  石川県
加賀    0/1     埼玉県  北海道  石川県
越前    0/1     埼玉県  北海道  福井県
若狭    0/1     埼玉県  北海道  福井県
甲斐    0/1     埼玉県  北海道  山梨県
信濃    0/1     埼玉県  北海道  長野県
美濃    0/1     埼玉県  北海道  岐阜県
飛騨    0/1     埼玉県  北海道  岐阜県
駿河    0/1     埼玉県  北海道  静岡県
伊豆    0/1     埼玉県  東京都  静岡県
遠江    0/1     埼玉県  東京都  静岡県
尾張    0/1     埼玉県  北海道  愛知県
三河    0/1     三重県  埼玉県  愛知県
伊勢    0/1     埼玉県  宮城県  三重県
伊賀    0/1     埼玉県  宮城県  三重県
志摩    0/1     埼玉県  北海道  三重県
紀伊    0/2     埼玉県,京都府   宮城県,沖縄県   三重県,和歌山県
近江    0/1     埼玉県  東京都  滋賀県
山城    0/1     山口県  山形県  京都府
丹波    0/2     埼玉県,北海道   東京都,奈良県   京都府,兵庫県
丹後    0/1     埼玉県  北海道  京都府
摂津    0/2     埼玉県,東京都   北海道,山口県   大阪府,兵庫県
和泉    0/1     和歌山県        埼玉県  大阪府
河内    0/1     埼玉県  石川県  大阪府
播磨    0/1     埼玉県  北海道  兵庫県
但馬    0/1     埼玉県  北海道  兵庫県
淡路    0/1     埼玉県  北海道  兵庫県
大和    0/1     大分県  埼玉県  奈良県
因幡    0/1     埼玉県  京都府  鳥取県
伯耆    0/1     埼玉県  北海道  鳥取県
石見    0/1     石川県  埼玉県  島根県
出雲    0/1     埼玉県  東京都  島根県
隠岐    0/1     埼玉県  岐阜県  島根県
備前    0/2     埼玉県,北海道   東京都,沖縄県   岡山県,香川県
備中    0/1     埼玉県  東京都  岡山県
美作    0/1     埼玉県  北海道  岡山県
備後    0/1     埼玉県  北海道  広島県
安芸    0/1     埼玉県  東京都  広島県
周防    0/1     埼玉県  東京都  山口県
長門    0/1     長野県  長崎県  山口県
阿波    0/1     埼玉県  北海道  徳島県
讃岐    0/1     埼玉県  香川県  香川県
伊予    0/1     埼玉県  宮城県  愛媛県
土佐    0/1     埼玉県  東京都  高知県
筑前    0/1     埼玉県  東京都  福岡県
筑後    0/1     埼玉県  東京都  福岡県
豊前    0/2     埼玉県,富山県   北海道,東京都   福岡県,大分県
肥前    0/2     埼玉県,北海道   東京都,大阪府   佐賀県,長崎県
壱岐    0/1     埼玉県  岐阜県  長崎県
対馬    0/1     埼玉県  北海道  長崎県
肥後    0/1     埼玉県  北海道  熊本県
豊後    0/1     埼玉県  北海道  大分県
日向    0/1     埼玉県  北海道  宮崎県
薩摩    0/1     佐賀県  埼玉県  鹿児島県
大隅    0/1     大分県  埼玉県  鹿児島県
琉球    1/1     沖縄県  北海道  沖縄県

accuracy: 0.03529411764705882
```

</details>

<details>
<summary>学習後(完全な自治体名)モデル: accuracy=0.647</summary>

```console
$ ./cluster_local_govs.py -l ./japan_old_countries.tsv -m ./trained-lgov-full/checkpoint-100/
陸奥    1/1     青森県  北海道  青森県
陸中    0/2     沖縄県,北海道   山口県,岩手県   岩手県,秋田県
陸前    0/1     岩手県  青森県  宮城県
羽後    1/2     秋田県,新潟県   福島県,岐阜県   秋田県,山形県
羽前    0/1     岐阜県  秋田県  山形県
岩代    0/1     岩手県  山口県  福島県
磐城    0/1     岩手県  静岡県  福島県
常陸    1/1     茨城県  宮城県  茨城県
下総    1/2     茨城県,栃木県   宮城県,奈良県   茨城県,千葉県
下野    1/1     栃木県  奈良県  栃木県
上野    1/1     群馬県  奈良県  群馬県
武蔵    1/3     東京都,沖縄県,大分県    山口県,広島県,山梨県    埼玉県,東京都,神奈川県
上総    0/1     茨城県  宮城県  千葉県
安房    0/1     山口県  東京都  千葉県
相模    1/1     神奈川県        宮城県  神奈川県
越後    0/1     福井県  島根県  新潟県
佐渡    1/1     新潟県  石川県  新潟県
越中    0/1     福井県  新潟県  富山県
能登    1/1     石川県  福井県  石川県
加賀    1/1     石川県  新潟県  石川県
越前    1/1     福井県  富山県  福井県
若狭    1/1     福井県  石川県  福井県
甲斐    1/1     山梨県  群馬県  山梨県
信濃    1/1     長野県  群馬県  長野県
美濃    1/1     岐阜県  富山県  岐阜県
飛騨    1/1     岐阜県  富山県  岐阜県
駿河    1/1     静岡県  神奈川県        静岡県
伊豆    1/1     静岡県  群馬県  静岡県
遠江    0/1     愛媛県  北海道  静岡県
尾張    1/1     愛知県  岡山県  愛知県
三河    0/1     三重県  愛知県  愛知県
伊勢    1/1     三重県  沖縄県  三重県
伊賀    1/1     三重県  愛媛県  三重県
志摩    1/1     三重県  奈良県  三重県
紀伊    2/2     三重県,和歌山県 奈良県,愛媛県   三重県,和歌山県
近江    1/1     滋賀県  群馬県  滋賀県
山城    0/1     香川県  愛媛県  京都府
丹波    1/2     兵庫県,山梨県   島根県,新潟県   京都府,兵庫県
丹後    1/1     京都府  鳥取県  京都府
摂津    1/2     大阪府,奈良県   兵庫県,香川県   大阪府,兵庫県
和泉    1/1     大阪府  和歌山県        大阪府
河内    0/1     茨城県  大阪府  大阪府
播磨    1/1     兵庫県  岐阜県  兵庫県
但馬    0/1     福島県  徳島県  兵庫県
淡路    1/1     兵庫県  神奈川県        兵庫県
大和    0/1     宮城県  神奈川県        奈良県
因幡    0/1     島根県  京都府  鳥取県
伯耆    1/1     鳥取県  山口県  鳥取県
石見    0/1     山形県  山口県  島根県
出雲    1/1     島根県  新潟県  島根県
隠岐    1/1     島根県  岐阜県  島根県
備前    1/2     岡山県,広島県   熊本県,愛知県   岡山県,香川県
備中    1/1     岡山県  広島県  岡山県
美作    1/1     岡山県  茨城県  岡山県
備後    0/1     岡山県  広島県  広島県
安芸    1/1     広島県  高知県  広島県
周防    1/1     山口県  鳥取県  山口県
長門    1/1     山口県  長崎県  山口県
阿波    1/1     徳島県  鹿児島県        徳島県
讃岐    0/1     愛媛県  香川県  香川県
伊予    1/1     愛媛県  沖縄県  愛媛県
土佐    1/1     高知県  徳島県  高知県
筑前    1/1     福岡県  佐賀県  福岡県
筑後    1/1     福岡県  茨城県  福岡県
豊前    1/2     福岡県,佐賀県   宮城県,茨城県   福岡県,大分県
肥前    0/2     福井県,福岡県   愛知県,熊本県   佐賀県,長崎県
壱岐    1/1     長崎県  佐賀県  長崎県
対馬    1/1     長崎県  佐賀県  長崎県
肥後    1/1     熊本県  大分県  熊本県
豊後    1/1     大分県  宮崎県  大分県
日向    1/1     宮崎県  大分県  宮崎県
薩摩    1/1     鹿児島県        長崎県  鹿児島県
大隅    1/1     鹿児島県        熊本県  鹿児島県
琉球    1/1     沖縄県  山口県  沖縄県

accuracy: 0.6470588235294118
```

</details>

<details>
<summary>学習後(部分的な自治体名)モデル: accuracy=0.682</summary>

```console
$ ./cluster_local_govs.py -l ./japan_old_countries.tsv -m ./trained-lgov-partial/checkpoint-100/
陸奥    1/1     青森県  秋田県  青森県
陸中    0/2     岡山県,愛知県   福岡県,北海道   岩手県,秋田県
陸前    0/1     岩手県  青森県  宮城県
羽後    1/2     秋田県,新潟県   岐阜県,群馬県   秋田県,山形県
羽前    0/1     岐阜県  秋田県  山形県
岩代    0/1     岩手県  宮城県  福島県
磐城    0/1     山口県  沖縄県  福島県
常陸    1/1     茨城県  宮城県  茨城県
下総    2/2     茨城県,千葉県   栃木県,埼玉県   茨城県,千葉県
下野    1/1     栃木県  奈良県  栃木県
上野    0/1     山梨県  栃木県  群馬県
武蔵    2/3     東京都,山梨県,神奈川県  静岡県,長野県,沖縄県    埼玉県,東京都,神奈川県
上総    0/1     茨城県  栃木県  千葉県
安房    0/1     山口県  千葉県  千葉県
相模    1/1     神奈川県        静岡県  神奈川県
越後    0/1     福井県  熊本県  新潟県
佐渡    1/1     新潟県  山形県  新潟県
越中    0/1     新潟県  長野県  富山県
能登    1/1     石川県  富山県  石川県
加賀    1/1     石川県  新潟県  石川県
越前    1/1     福井県  富山県  福井県
若狭    1/1     福井県  石川県  福井県
甲斐    1/1     山梨県  長野県  山梨県
信濃    1/1     長野県  山梨県  長野県
美濃    1/1     岐阜県  富山県  岐阜県
飛騨    1/1     岐阜県  富山県  岐阜県
駿河    1/1     静岡県  山梨県  静岡県
伊豆    1/1     静岡県  島根県  静岡県
遠江    0/1     福岡県  熊本県  静岡県
尾張    1/1     愛知県  福井県  愛知県
三河    1/1     愛知県  岡山県  愛知県
伊勢    1/1     三重県  静岡県  三重県
伊賀    1/1     三重県  愛媛県  三重県
志摩    1/1     三重県  滋賀県  三重県
紀伊    2/2     和歌山県,三重県 静岡県,鳥取県   三重県,和歌山県
近江    1/1     滋賀県  愛知県  滋賀県
山城    0/1     佐賀県  宮崎県  京都府
丹波    1/2     兵庫県,静岡県   愛知県,広島県   京都府,兵庫県
丹後    0/1     大分県  京都府  京都府
摂津    2/2     大阪府,兵庫県   奈良県,香川県   大阪府,兵庫県
和泉    1/1     大阪府  愛媛県  大阪府
河内    0/1     茨城県  大阪府  大阪府
播磨    1/1     兵庫県  岡山県  兵庫県
但馬    0/1     鹿児島県        徳島県  兵庫県
淡路    1/1     兵庫県  香川県  兵庫県
大和    0/1     神奈川県        宮城県  奈良県
因幡    0/1     奈良県  京都府  鳥取県
伯耆    1/1     鳥取県  福井県  鳥取県
石見    0/1     福島県  石川県  島根県
出雲    1/1     島根県  新潟県  島根県
隠岐    1/1     島根県  石川県  島根県
備前    1/2     岡山県,熊本県   福岡県,広島県   岡山県,香川県
備中    1/1     岡山県  熊本県  岡山県
美作    1/1     岡山県  熊本県  岡山県
備後    0/1     岡山県  熊本県  広島県
安芸    1/1     広島県  高知県  広島県
周防    1/1     山口県  広島県  山口県
長門    1/1     山口県  山梨県  山口県
阿波    1/1     徳島県  愛媛県  徳島県
讃岐    1/1     香川県  兵庫県  香川県
伊予    1/1     愛媛県  沖縄県  愛媛県
土佐    1/1     高知県  徳島県  高知県
筑前    1/1     福岡県  茨城県  福岡県
筑後    1/1     福岡県  茨城県  福岡県
豊前    1/2     福岡県,佐賀県   岡山県,福井県   福岡県,大分県
肥前    0/2     福岡県,福井県   愛知県,熊本県   佐賀県,長崎県
壱岐    1/1     長崎県  沖縄県  長崎県
対馬    1/1     長崎県  鹿児島県        長崎県
肥後    1/1     熊本県  京都府  熊本県
豊後    1/1     大分県  熊本県  大分県
日向    1/1     宮崎県  東京都  宮崎県
薩摩    1/1     鹿児島県        長崎県  鹿児島県
大隅    1/1     鹿児島県        大分県  鹿児島県
琉球    1/1     沖縄県  長崎県  沖縄県

accuracy: 0.6823529411764706
```

</details>

## 考察・検討

やはり若干ではあるが旧国名の概念を獲得しているようだ。

自治体名に旧国名が含まれている場合もそれなりにあるが、
「琉球」や「大隈」など自治体名には一切表れない旧国名を
正しくクラスタリングできているようになっている場合がある。

このことから
もともと言語モデルが持っていた高次な概念が
学習により表出するようになったと解釈するのが
もっともらしい。

また城名および旧国名のクラスタリングでは、
特別区自治体名の市町村名を省略した部分名で学習したモデル
のほうが僅か数ポイントではあるものの、
共通して良い成績になっている。
繰り返される市町村名がマイナスの方向に働いている可能性がある。
